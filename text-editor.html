<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TaskFlows Text Editor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><!-- FIXED FOR MOBILE -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Baloo+2&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    body {
      background: linear-gradient(135deg, #f3e7e9 0%, #e3eeff 100%);
      margin: 0;
      font-family: 'Inter', 'Baloo 2', Arial, sans-serif;
      color: #222;
      min-height: 100vh;
      overflow-x: hidden;
    }
    .editor-container {
      max-width: 900px;
      margin: 36px auto 0 auto;
      box-shadow: 0 8px 32px rgba(136,90,248,0.08);
      background: #fff;
      border-radius: 18px;
      padding: 32px 28px 38px 28px;
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 22px;
      min-height: 85vh;
    }
    .editor-toolbar {
      display: flex;
      gap: 11px;
      flex-wrap: wrap;
      align-items: center;
      border-radius: 14px;
      background: #f7f6fd;
      box-shadow: 0 2px 8px #885af80d;
      padding: 13px 13px 8px 13px;
      margin-bottom: 2px;
      flex-wrap: wrap;
      overflow-x: auto;
    }
    .editor-toolbar button, .editor-toolbar select, .editor-toolbar input[type="color"] {
      border: none;
      background: none;
      font-size: 1.15rem;
      cursor: pointer;
      padding: 7px 12px;
      border-radius: 8px;
      transition: background 0.18s, color 0.18s;
      color: #6c47d9;
      margin-right: 2px;
    }
    .editor-toolbar button:hover, .editor-toolbar select:hover, .editor-toolbar input[type="color"]:hover {
      background: #ece8f9;
      color: #885af8;
    }
    .editor-toolbar select, .editor-toolbar input[type="color"] {
      font-size: 1.05rem;
      color: #222;
      background: #f3f0fa;
      padding: 6px 9px;
      border: 1.2px solid #e0dbfa;
      margin-right: 7px;
      min-width: 69px;
    }
    .editor-toolbar input[type="color"] {
      padding: 3px 3px;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      border: 2px solid #ece8f9;
      cursor: pointer;
      background: none;
      margin-right: 0;
      vertical-align: middle;
    }
    .editor-toolbar .fa-solid, .editor-toolbar .fa {
      pointer-events: none;
    }
    .editor-toolbar label {
      margin-right: 10px;
      font-weight: 600;
      color: #6c47d9;
      font-size: 1.01rem;
    }
    .editor-area {
      min-height: 380px;
      background: #f6f5fc;
      border-radius: 11px;
      border: 1.5px solid #ececec;
      padding: 24px 18px;
      font-size: 1.17em;
      font-family: inherit;
      color: #222;
      outline: none;
      box-shadow: 0 2px 12px #885af80a;
      transition: border 0.23s;
      margin-bottom: 6px;
      width: 100%;
      overflow-x: auto;
      word-break: break-word;
    }
    .editor-area:focus {
      border: 1.5px solid #885af8;
    }
    .editor-buttons {
      display: flex;
      gap: 14px;
      margin-top: 4px;
      flex-wrap: wrap;
    }
    .editor-buttons button, .editor-buttons a.dashboard-btn {
      background: linear-gradient(90deg, #885af8 0%, #43cea2 100%);
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 12px 22px;
      font-size: 1.06em;
      font-weight: 700;
      letter-spacing: 1px;
      cursor: pointer;
      box-shadow: 0 2px 12px #885af826;
      transition: background 0.19s, box-shadow 0.19s, color 0.19s;
      outline: none;
      display: flex;
      align-items: center;
      gap: 7px;
      text-decoration: none;
    }
    .editor-buttons button:hover, .editor-buttons a.dashboard-btn:hover {
      background: linear-gradient(90deg, #43cea2 0%, #885af8 100%);
      box-shadow: 0 4px 22px #43cea235;
      color: #fff;
      text-decoration: none;
    }
    .editor-buttons a.dashboard-btn:visited,
    .editor-buttons a.dashboard-btn:active {
      color: #fff;
      text-decoration: none;
    }
    .drafts-link {
      margin-left: auto;
      font-size: 1.06em;
      text-decoration: none;
      color: #885af8;
      font-weight: 600;
      background: #f7f6fd;
      padding: 10px 20px;
      border-radius: 8px;
      border: 1.2px solid #ece8f9;
      transition: background 0.17s, color 0.17s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .drafts-link:hover {
      background: #ece8f9;
      color: #43cea2;
    }
    .doc-title-row {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 12px;
    }
    .doc-title-row input {
      font-size: 1.14em;
      font-weight: 700;
      color: #6c47d9;
      border: none;
      background: transparent;
      border-bottom: 2px solid #ececec;
      outline: none;
      padding: 5px 6px;
      border-radius: 4px 4px 0 0;
      margin-right: 12px;
      min-width: 120px;
      max-width: 300px;
      transition: border 0.18s;
    }
    .doc-title-row input:focus {
      border-bottom: 2px solid #885af8;
      color: #222;
    }
    .saved-status {
      font-size: 1.04em;
      color: #43cea2;
      margin-left: 5px;
      opacity: 0.85;
      font-weight: 600;
      transition: color 0.16s;
    }
    .share-link-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 12px;
      font-size: 1.02em;
      color: #885af8;
    }
    .share-link-box {
      background: #f3f0fa;
      border: 1.2px solid #ececec;
      border-radius: 7px;
      padding: 4px 10px;
      font-size: 0.98em;
      margin-right: 7px;
      user-select: all;
      color: #6c47d9;
      word-break: break-all;
    }
    .copy-link-btn {
      background: #ece8f9;
      border: none;
      color: #885af8;
      border-radius: 8px;
      padding: 6px 13px;
      font-size: 1em;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.12s;
    }
    .copy-link-btn:hover {
      background: #d2c0ff;
      color: #fff;
    }
    @media (max-width: 1000px) {
      .editor-container {
        max-width: 97vw;
        padding: 16px 3vw;
      }
    }
    /* IMPROVED RESPONSIVENESS FOR MOBILE */
    @media (max-width: 600px) {
      .editor-container {
        max-width: 100vw;
        min-width: 0;
        margin: 0;
        border-radius: 0;
        padding: 1vw 0vw 10vw 0vw;
        box-shadow: none;
        gap: 9px;
      }
      .editor-toolbar {
        flex-direction: row;
        flex-wrap: wrap;
        align-items: stretch;
        gap: 5px;
        padding: 9px 2vw 6px 2vw;
        box-shadow: none;
        font-size: 0.95em;
        justify-content: flex-start;
        overflow-x: auto;
        border-radius: 0;
      }
      .editor-toolbar button, .editor-toolbar select, .editor-toolbar input[type="color"] {
        font-size: 0.98em;
        padding: 6px 8px;
        margin-right: 0;
        border-radius: 7px;
      }
      .editor-toolbar select, .editor-toolbar input[type="color"] {
        min-width: 0;
        width: auto;
        font-size: 0.96em;
      }
      .editor-toolbar label {
        margin-right: 3px;
        font-size: 0.94em;
      }
      .editor-area {
        min-height: 120px;
        padding: 10px 4vw;
        font-size: 0.97em;
        border-radius: 7px;
        box-shadow: none;
        border-width: 1px;
      }
      .editor-buttons {
        flex-direction: column;
        gap: 6px;
        margin-top: 3px;
      }
      .editor-buttons button, .editor-buttons a.dashboard-btn {
        width: 100%;
        min-width: 0;
        padding: 9px 0;
        font-size: 0.97em;
        border-radius: 6px;
        letter-spacing: 0.2px;
      }
      .drafts-link {
        font-size: 0.97em;
        padding: 7px 0;
        border-radius: 6px;
        margin-left: 0;
        margin-top: 6px;
        width: 100%;
        justify-content: center;
      }
      .doc-title-row {
        flex-direction: column;
        align-items: stretch;
        gap: 3px;
        margin-bottom: 6px;
      }
      .doc-title-row input {
        font-size: 0.99em;
        min-width: 0;
        max-width: 100vw;
        margin-right: 0;
        border-radius: 4px 4px 0 0;
        padding: 7px 0 3px 2px;
      }
      .saved-status {
        font-size: 0.92em;
        margin-left: 0;
      }
      .share-link-row {
        flex-direction: column;
        align-items: stretch;
        gap: 5px;
        margin-top: 7px;
        font-size: 0.95em;
      }
      .share-link-box {
        font-size: 0.97em;
        padding: 3px 4px;
        border-radius: 6px;
        margin-right: 0;
      }
      .copy-link-btn {
        padding: 6px 0;
        border-radius: 6px;
        margin-top: 3px;
      }
    }
  </style>
</head>
<body>
  <div class="editor-container">
    <div class="doc-title-row">
      <input id="docTitle" placeholder="Untitled Document" maxlength="50">
      <span class="saved-status" id="savedStatus">Saved</span>
      <a href="drafts.html" class="drafts-link"><i class="fa fa-folder-open"></i>Drafts</a>
    </div>
    <div class="editor-toolbar">
      <button title="Bold (Ctrl+B)" onclick="format('bold')"><i class="fa fa-bold"></i></button>
      <button title="Italic (Ctrl+I)" onclick="format('italic')"><i class="fa fa-italic"></i></button>
      <button title="Underline (Ctrl+U)" onclick="format('underline')"><i class="fa fa-underline"></i></button>
      <button title="Strikethrough" onclick="format('strikeThrough')"><i class="fa fa-strikethrough"></i></button>
      <label for="fontSelect">Font:</label>
      <select id="fontSelect" onchange="changeFont(this.value)">
        <option value="Inter">Inter</option>
        <option value="Arial">Arial</option>
        <option value="Baloo 2">Baloo 2</option>
        <option value="Courier New">Courier New</option>
        <option value="Georgia">Georgia</option>
        <option value="Times New Roman">Times New Roman</option>
        <option value="Verdana">Verdana</option>
      </select>
      <label for="fontSizeSelect">Size:</label>
      <select id="fontSizeSelect" onchange="changeFontSize(this.value)">
        <option value="3">Normal</option>
        <option value="1">Small</option>
        <option value="2">Medium</option>
        <option value="4">Large</option>
        <option value="5">X-Large</option>
        <option value="6">XX-Large</option>
        <option value="7">Huge</option>
      </select>
      <label for="colorInput">Text Color:</label>
      <input type="color" id="colorInput" value="#6c47d9" onchange="changeColor(this.value)">
      <label for="bgColorInput">Highlight:</label>
      <input type="color" id="bgColorInput" value="#f7f6fd" onchange="changeBgColor(this.value)">
      <button title="Left Align" onclick="format('justifyLeft')"><i class="fa fa-align-left"></i></button>
      <button title="Center Align" onclick="format('justifyCenter')"><i class="fa fa-align-center"></i></button>
      <button title="Right Align" onclick="format('justifyRight')"><i class="fa fa-align-right"></i></button>
      <button title="Numbered List" onclick="format('insertOrderedList')"><i class="fa fa-list-ol"></i></button>
      <button title="Bulleted List" onclick="format('insertUnorderedList')"><i class="fa fa-list-ul"></i></button>
      <button title="Undo" onclick="format('undo')"><i class="fa fa-undo"></i></button>
      <button title="Redo" onclick="format('redo')"><i class="fa fa-redo"></i></button>
      <button title="Clear Formatting" onclick="clearFormatting()"><i class="fa fa-eraser"></i></button>
    </div>
    <div id="editor" class="editor-area" contenteditable="true" spellcheck="true"></div>
    <div class="editor-buttons">
      <button onclick="saveDraft()" title="Save Draft"><i class="fa fa-save"></i>Save Draft</button>
      <button onclick="newDraft()" title="New Draft"><i class="fa fa-file-alt"></i>New Draft</button>
      <button onclick="downloadDoc()" title="Download"><i class="fa fa-download"></i>Download</button>
      <button onclick="shareDoc()" title="Share"><i class="fa fa-link"></i>Share</button>
      <a href="index.html" class="dashboard-btn" title="Back to Dashboard"><i class="fa fa-arrow-left"></i>Back to Dashboard</a>
    </div>
    <div id="shareLinkRow" class="share-link-row" style="display:none;">
      <span>Shareable Link:</span>
      <span id="shareLinkBox" class="share-link-box"></span>
      <button class="copy-link-btn" onclick="copyShareLink()"><i class="fa fa-copy"></i> Copy</button>
    </div>
  </div>
  <script>
    // --- Toolbar functions ---
    function format(cmd, val = null) {
      document.execCommand(cmd, false, val);
      saveAuto();
    }
    function changeFont(font) {
      document.execCommand("fontName", false, font);
      saveAuto();
    }
    function changeFontSize(size) {
      document.execCommand("fontSize", false, size);
      saveAuto();
    }
    function changeColor(color) {
      document.execCommand("foreColor", false, color);
      saveAuto();
    }
    function changeBgColor(color) {
      document.execCommand("hiliteColor", false, color);
      saveAuto();
    }
    function clearFormatting() {
      document.execCommand('removeFormat', false, null);
      saveAuto();
    }

    // --- Drafts Management ---
    const draftsKey = "taskflows_drafts";
    let currentDraftId = null;
    let autoSaveTimeout = null;

    function getDrafts() {
      return JSON.parse(localStorage.getItem(draftsKey) || "[]");
    }
    function setDrafts(drafts) {
      localStorage.setItem(draftsKey, JSON.stringify(drafts));
    }
    function getDraft(id) {
      const drafts = getDrafts();
      return drafts.find(d => d.id === id);
    }
    function saveDraft() {
      const title = document.getElementById('docTitle').value.trim() || "Untitled Document";
      const html = document.getElementById('editor').innerHTML;
      let drafts = getDrafts();
      let now = new Date().toISOString();
      if (currentDraftId) {
        const idx = drafts.findIndex(d => d.id === currentDraftId);
        if (idx >= 0) {
          drafts[idx].title = title;
          drafts[idx].html = html;
          drafts[idx].updated = now;
        } else {
          drafts.push({id: currentDraftId, title, html, updated: now});
        }
      } else {
        currentDraftId = "draft-" + Date.now();
        drafts.push({id: currentDraftId, title, html, updated: now});
      }
      setDrafts(drafts);
      showSaved("Saved");
    }
    function saveAuto() {
      document.getElementById('savedStatus').textContent = "Saving...";
      clearTimeout(autoSaveTimeout);
      autoSaveTimeout = setTimeout(saveDraft, 800);
    }
    function showSaved(msg) {
      const status = document.getElementById('savedStatus');
      status.textContent = msg;
      status.style.color = "#43cea2";
      setTimeout(() => { status.textContent = "Saved"; status.style.color = "#43cea2"; }, 1200);
    }
    function newDraft() {
      if (!confirm("Do you want to create a new draft? Unsaved changes will be lost.")) return;
      document.getElementById('docTitle').value = "";
      document.getElementById('editor').innerHTML = "";
      currentDraftId = null;
      showSaved("New Draft");
      document.getElementById('shareLinkRow').style.display = "none";
    }
    function loadDraft(id) {
      const draft = getDraft(id);
      if (draft) {
        document.getElementById('docTitle').value = draft.title;
        document.getElementById('editor').innerHTML = draft.html;
        currentDraftId = id;
        showSaved("Draft Loaded");
        document.getElementById('shareLinkRow').style.display = "none";
      }
    }
    // --- Download Document ---
    function downloadDoc() {
      const title = document.getElementById('docTitle').value.trim() || "Untitled_Document";
      const html = document.getElementById('editor').innerHTML;
      const blob = new Blob([html], { type: "text/html" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = title.replace(/\s+/g, '_') + ".html";
      document.body.appendChild(a);
      a.click();
      setTimeout(() => { document.body.removeChild(a); URL.revokeObjectURL(url); }, 100);
      showSaved("Downloaded");
    }
    // --- Share Document ---
    function shareDoc() {
      const data = {
        title: document.getElementById('docTitle').value.trim() || "Untitled Document",
        html: document.getElementById('editor').innerHTML
      };
      const encoded = encodeURIComponent(btoa(unescape(encodeURIComponent(JSON.stringify(data)))));
      const shareURL = `${window.location.origin}${window.location.pathname}?share=${encoded}`;
      document.getElementById('shareLinkBox').textContent = shareURL;
      document.getElementById('shareLinkRow').style.display = "";
    }
    function copyShareLink() {
      const link = document.getElementById('shareLinkBox').textContent;
      if (navigator.clipboard) { navigator.clipboard.writeText(link); }
      else {
        let tmp = document.createElement("textarea");
        tmp.value = link;
        document.body.appendChild(tmp);
        tmp.select();
        document.execCommand("copy");
        document.body.removeChild(tmp);
      }
      showSaved("Link Copied!");
    }
    // --- Keyboard Shortcuts ---
    document.addEventListener('keydown', function(e){
      if(e.ctrlKey && e.key.toLowerCase() === "b"){ e.preventDefault(); format('bold'); }
      if(e.ctrlKey && e.key.toLowerCase() === "i"){ e.preventDefault(); format('italic'); }
      if(e.ctrlKey && e.key.toLowerCase() === "u"){ e.preventDefault(); format('underline'); }
      if(e.ctrlKey && e.key.toLowerCase() === "s"){ e.preventDefault(); saveDraft(); }
      if(e.ctrlKey && e.key.toLowerCase() === "n"){ e.preventDefault(); newDraft(); }
    });

    // --- Auto Save on changes ---
    document.getElementById('editor').addEventListener('input', saveAuto);
    document.getElementById('docTitle').addEventListener('input', saveAuto);

    // --- Load shared doc if present ---
    function tryImportSharedDoc() {
      const urlParams = new URLSearchParams(window.location.search);
      const shared = urlParams.get('share');
      if (shared) {
        let data;
        try {
          data = JSON.parse(decodeURIComponent(escape(atob(decodeURIComponent(shared)))));
        } catch (e) {
          alert('Failed to import shared document.');
          return;
        }
        document.getElementById('docTitle').value = data.title || "Untitled Document";
        document.getElementById('editor').innerHTML = data.html || "";
        currentDraftId = null;
        showSaved("Imported");
        document.getElementById('shareLinkRow').style.display = "none";
        window.history.replaceState({}, document.title, window.location.pathname);
      }
    }
    // --- On page load, load last draft ---
    function loadLastDraft() {
      const drafts = getDrafts();
      if (drafts.length > 0) {
        const last = drafts[drafts.length-1];
        document.getElementById('docTitle').value = last.title || "";
        document.getElementById('editor').innerHTML = last.html || "";
        currentDraftId = last.id;
      }
    }
    tryImportSharedDoc();
    loadLastDraft();
  </script>
</body>
</html>
