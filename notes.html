<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-RQR9BDLJ26"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-RQR9BDLJ26');
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="icon" type="image/x-icon" href="Untitled-removebg-preview.png">

  <title>Taskflows - Notes</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/@phosphor-icons/web"></script>

  <style>
    :root {
      --bg-main: #050505;
      --bg-sidebar: #000000;
      --bg-card: #111111;
      --bg-hover: #1A1A1A;
      --accent-purple: #7C6DFF;
      --accent-purple-glow: rgba(124, 109, 255, 0.4);
      --text-primary: #FFFFFF;
      --text-secondary: #888888;
      --text-muted: #555555;
      --border-subtle: #222222;
      --sidebar-width: 280px;
      --transition-speed: 0.2s;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      background-color: var(--bg-main);
      color: var(--text-primary);
      height: 100vh;
      display: flex;
      overflow: hidden;
    }

    /* --- SIDEBAR --- */
    .sidebar {
      width: var(--sidebar-width);
      background-color: var(--bg-sidebar);
      height: 100%;
      display: flex;
      flex-direction: column;
      border-right: 1px solid var(--border-subtle);
      flex-shrink: 0;
      position: relative;
      z-index: 50;
      transition: transform 0.3s ease;
    }

    .sidebar-content {
      padding: 24px;
      overflow-y: auto;
      flex: 1;
    }

    .logo-area {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
      font-size: 1.2rem;
      margin-bottom: 30px;
      color: white;
      text-decoration: none;
    }

    .logo-icon {
      color: var(--accent-purple);
      font-size: 1.5rem;
    }

    .menu-group {
      margin-bottom: 30px;
    }

    .menu-label {
      color: var(--text-muted);
      font-size: 0.7rem;
      letter-spacing: 1px;
      text-transform: uppercase;
      font-weight: 600;
      margin-bottom: 10px;
      padding-left: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .add-note-btn {
      color: var(--accent-purple);
      cursor: pointer;
      font-size: 1.1rem;
      padding: 5px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      color: var(--text-secondary);
      padding: 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: all var(--transition-speed);
      font-size: 0.95rem;
      text-decoration: none;
      margin-bottom: 4px;
      user-select: none;
    }

    .nav-item:hover {
      color: var(--text-primary);
      background-color: var(--bg-hover);
    }

    .nav-item.active {
      background: linear-gradient(90deg, var(--accent-purple), #5E4EF2);
      color: white;
      box-shadow: 0 4px 15px var(--accent-purple-glow);
    }

    /* Saved Notes List Styling */
    .note-list-item {
      display: flex;
      flex-direction: column;
      padding: 10px 12px;
      border-radius: 8px;
      cursor: pointer;
      color: var(--text-secondary);
      border-left: 2px solid transparent;
      margin-bottom: 5px;
    }

    .note-list-item:hover {
      background: var(--bg-hover);
    }

    .note-list-item.active-note {
      background: var(--bg-hover);
      border-left-color: var(--accent-purple);
      color: white;
    }

    .note-item-title {
      font-weight: 500;
      font-size: 0.95rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .note-item-date {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 4px;
    }

    /* --- MOBILE OVERLAY --- */
    .mobile-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
      z-index: 40;
      opacity: 0;
      pointer-events: none;
      transition: 0.3s;
    }

    .mobile-overlay.active {
      opacity: 1;
      pointer-events: all;
    }

    /* --- MAIN CONTENT --- */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      position: relative;
      background: var(--bg-main);
      width: 100%;
    }

    .top-bar {
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      border-bottom: 1px solid var(--border-subtle);
      background: var(--bg-main);
      z-index: 20;
    }

    .menu-toggle {
      display: none;
      font-size: 1.5rem;
      color: white;
      cursor: pointer;
      margin-right: 15px;
    }

    .breadcrumbs {
      color: var(--text-secondary);
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 8px;
      overflow: hidden;
      white-space: nowrap;
    }

    .top-actions {
      display: flex;
      gap: 10px;
    }

    .icon-btn {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      color: var(--text-secondary);
      width: 36px;
      height: 36px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: 0.2s;
    }

    .icon-btn:hover {
      border-color: var(--text-secondary);
      color: var(--text-primary);
    }

    .icon-btn.danger:hover {
      border-color: #ff4d4d;
      color: #ff4d4d;
    }

    /* --- EDITOR --- */
    .editor-container {
      flex: 1;
      overflow-y: auto;
      padding: 40px 15%;
      position: relative;
    }

    .note-cover {
      height: 200px;
      width: 100%;
      border-radius: 12px;
      background: linear-gradient(120deg, #1e1e2f, #121212);
      margin-bottom: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #333;
      border: 1px dashed var(--border-subtle);
      cursor: pointer;
      transition: 0.3s;
      position: relative;
      overflow: hidden;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }

    .note-cover:hover {
      border-color: var(--accent-purple);
    }

    .note-cover span {
      background: rgba(0, 0, 0, 0.5);
      padding: 8px 16px;
      border-radius: 20px;
      color: white;
      backdrop-filter: blur(4px);
      transition: 0.2s;
    }

    /* Hide text if image exists, show on hover */
    .note-cover.has-image span {
      opacity: 0;
    }

    .note-cover.has-image:hover span {
      opacity: 1;
    }

    .note-title {
      background: transparent;
      border: none;
      color: white;
      font-size: 2.5rem;
      font-weight: 700;
      width: 100%;
      outline: none;
      margin-bottom: 20px;
      line-height: 1.2;
    }

    .note-title::placeholder {
      color: #333;
    }

    .note-meta {
      display: flex;
      gap: 15px;
      margin-bottom: 40px;
      font-size: 0.85rem;
      color: var(--text-secondary);
      flex-wrap: wrap;
    }

    .meta-item {
      display: flex;
      align-items: center;
      gap: 6px;
      background: var(--bg-card);
      padding: 6px 12px;
      border-radius: 6px;
    }

    /* EDITOR CONTENT BLOCKS */
    .editor-body {
      min-height: 300px;
      outline: none;
      color: #e0e0e0;
      line-height: 1.7;
      font-size: 1.1rem;
      padding-bottom: 100px;
    }

    .editor-body:empty:before {
      content: 'Type "/" for commands or just start writing...';
      color: #444;
    }

    /* Styles for content inside editable area */
    .editor-body h1 {
      font-size: 2em;
      margin-top: 0.5em;
      margin-bottom: 0.5em;
      color: white;
    }

    .editor-body h2 {
      font-size: 1.5em;
      margin-top: 0.8em;
      margin-bottom: 0.5em;
      color: white;
    }

    .editor-body ul {
      padding-left: 20px;
    }

    .editor-body li {
      margin-bottom: 5px;
    }

    .editor-body code {
      background: #222;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: monospace;
      color: var(--accent-purple);
    }

    .editor-body blockquote {
      border-left: 3px solid var(--accent-purple);
      padding-left: 15px;
      color: var(--text-secondary);
      font-style: italic;
    }

    /* Checkbox styling within editor */
    .todo-item {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 5px 0;
    }

    .todo-checkbox {
      width: 18px;
      height: 18px;
      border: 2px solid var(--text-muted);
      border-radius: 4px;
      cursor: pointer;
      display: inline-block;
      flex-shrink: 0;
    }

    .todo-checkbox.checked {
      background: var(--accent-purple);
      border-color: var(--accent-purple);
    }

    .todo-text.checked {
      text-decoration: line-through;
      color: var(--text-muted);
    }

    /* Slash Menu */
    .slash-menu {
      position: fixed;
      /* Changed to fixed for better mobile handling */
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
      padding: 8px;
      width: 220px;
      display: none;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.7);
      z-index: 100;
      max-height: 300px;
      overflow-y: auto;
    }

    .slash-item {
      padding: 10px 12px;
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 0.95rem;
      transition: 0.1s;
    }

    .slash-item:hover {
      background: var(--accent-purple);
      color: white;
    }

    .slash-item i {
      font-size: 1.2rem;
    }

    /* Saving Indicator */
    .save-status {
      font-size: 0.8rem;
      color: var(--text-muted);
      transition: color 0.3s;
    }

    .save-status.saved {
      color: var(--text-secondary);
    }

    /* --- RESPONSIVE / MOBILE --- */
    @media (max-width: 900px) {
      .menu-toggle {
        display: block;
      }

      .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        bottom: 0;
        transform: translateX(-100%);
        box-shadow: 10px 0 30px rgba(0, 0, 0, 0.5);
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .editor-container {
        padding: 20px;
        /* Less padding on mobile */
      }

      .note-title {
        font-size: 1.8rem;
      }

      .top-bar {
        padding: 0 15px;
      }

      /* Hide non-essential nav items on really small screens if needed */
      .breadcrumbs span:not(:last-child) {
        display: none;
      }

      .breadcrumbs i {
        display: inline-block;
      }
    }
  </style>
</head>

<body>

  <div class="mobile-overlay" id="mobileOverlay" onclick="toggleSidebar()"></div>

  <nav class="sidebar" id="sidebar">
    <div class="sidebar-content">
      <a href="#" class="logo-area">
        <i class="ph-fill ph-polygon logo-icon"></i>
        <span>Taskflows</span>
      </a>

      <div class="menu-group">
        <div class="menu-label">
          MY NOTES
          <i class="ph ph-plus-circle add-note-btn" onclick="createNewNote()" title="New Note"></i>
        </div>
        <div id="notesListContainer">
        </div>
      </div>

      <div class="menu-group">
        <div class="menu-label">Workspace</div>
        <a href="dashboard.html" class="nav-item">
          <i class="ph ph-squares-four"></i> Dashboard
        </a>
        <a href="text-editor.html" class="nav-item">
          <i class="ph ph-squares-four"></i> Text Editor
        </a>
        <a href="to-do-list.html" class="nav-item">
          <i class="ph ph-list-checks"></i> To-Do Lists
        </a>
        <a href="notes.html" class="nav-item">
          <i class=""></i> Notes
        </a>
        <a href="whiteboard.html" class="nav-item">
          <i class=""></i> Whiteboard
        </a>
        <a href="lists.html" class="nav-item">
          <i class=""></i> Lists
        </a>
        <a href="journal.html" class="nav-item">
          <i class=""></i> Journal
        </a>
        <a href="quicknotes.html" class="nav-item">
          <i class=""></i> Quick Notes
        </a>


      </div>

      <div class="menu-group" style="margin-top:auto">
        <a href="#" class="nav-item">
          <i class="ph ph-gear"></i> Settings
        </a>
      </div>
    </div>
  </nav>

  <main class="main-content">
    <header class="top-bar">
      <div style="display:flex; align-items:center;">
        <i class="ph ph-list menu-toggle" onclick="toggleSidebar()"></i>
        <div class="breadcrumbs">
          <i class="ph ph-note"></i>
          <span>/</span>
          <span id="headerTitle" style="color:white;">Untitled</span>
        </div>
      </div>

      <div class="top-actions">
        <span id="saveStatus" class="save-status">Saved</span>
        <div class="icon-btn danger" onclick="deleteCurrentNote()" title="Delete Note"><i class="ph ph-trash"></i></div>
        <div class="icon-btn" title="Note Info"><i class="ph ph-info"></i></div>
      </div>
    </header>

    <div class="editor-container" id="editorScroll">

      <input type="file" id="coverUpload" accept="image/*" hidden>

      <div class="note-cover" id="noteCoverArea">
        <span id="coverText"><i class="ph ph-image"></i> Add Cover Image</span>
      </div>

      <div class="note-meta">
        <div class="meta-item"><i class="ph ph-calendar-blank"></i> <span id="currentDate"></span></div>
        <div class="meta-item"><i class="ph ph-clock"></i> <span id="lastEdited">Just now</span></div>
      </div>

      <input type="text" class="note-title" id="noteTitleInput" placeholder="Untitled Note">

      <div class="editor-body" id="editorBody" contenteditable="true" spellcheck="false"></div>

    </div>

    <div class="slash-menu" id="slashMenu">
      <div class="slash-item" onclick="execCmd('formatBlock', 'H1')"><i class="ph ph-text-h-one"></i> Heading 1</div>
      <div class="slash-item" onclick="execCmd('formatBlock', 'H2')"><i class="ph ph-text-h-two"></i> Heading 2</div>
      <div class="slash-item" onclick="execCmd('insertUnorderedList')"><i class="ph ph-list-bullets"></i> Bullet List
      </div>
      <div class="slash-item" onclick="insertCheckbox()"><i class="ph ph-check-square"></i> To-Do Item</div>
      <div class="slash-item" onclick="insertCodeBlock()"><i class="ph ph-code"></i> Code Block</div>
      <div class="slash-item" onclick="execCmd('formatBlock', 'BLOCKQUOTE')"><i class="ph ph-quotes"></i> Quote</div>
    </div>

  </main>

  <script>
    // --- STATE MANAGEMENT ---
    let notes = JSON.parse(localStorage.getItem('tf_notes')) || [];
    let currentNoteId = null;

    // DOM Elements
    const editorBody = document.getElementById('editorBody');
    const titleInput = document.getElementById('noteTitleInput');
    const noteCover = document.getElementById('noteCoverArea');
    const fileInput = document.getElementById('coverUpload');
    const notesListContainer = document.getElementById('notesListContainer');
    const sidebar = document.getElementById('sidebar');
    const mobileOverlay = document.getElementById('mobileOverlay');
    const saveStatus = document.getElementById('saveStatus');
    const headerTitle = document.getElementById('headerTitle');
    const slashMenu = document.getElementById('slashMenu');

    // --- INITIALIZATION ---
    window.onload = () => {
      if (notes.length === 0) {
        createNewNote();
      } else {
        // Load the most recent note
        loadNote(notes[0].id);
      }
      renderNotesList();
    };

    // --- CORE FUNCTIONS ---

    function createNewNote() {
      const newNote = {
        id: Date.now(),
        title: '',
        content: '',
        coverImage: null,
        dateCreated: new Date().toLocaleDateString(),
        lastEdited: Date.now()
      };
      notes.unshift(newNote); // Add to top
      saveData();
      loadNote(newNote.id);
      renderNotesList();

      // Mobile UX: Close sidebar after creating new note
      if (window.innerWidth <= 900) toggleSidebar();
    }

    function loadNote(id) {
      currentNoteId = id;
      const note = notes.find(n => n.id === id);
      if (!note) return;

      // Populate UI
      titleInput.value = note.title;
      editorBody.innerHTML = note.content;
      headerTitle.innerText = note.title || "Untitled";

      // Date Logic
      document.getElementById('currentDate').innerText = note.dateCreated;
      updateTimeDisplay(note.lastEdited);

      // Cover Image Logic
      if (note.coverImage) {
        noteCover.style.backgroundImage = `url(${note.coverImage})`;
        noteCover.classList.add('has-image');
        document.getElementById('coverText').innerHTML = "<i class='ph ph-arrows-clockwise'></i> Change Cover";
      } else {
        noteCover.style.backgroundImage = 'none';
        noteCover.classList.remove('has-image');
        document.getElementById('coverText').innerHTML = "<i class='ph ph-image'></i> Add Cover Image";
      }

      // Highlight active sidebar item
      renderNotesList();
    }

    function saveData() {
      localStorage.setItem('tf_notes', JSON.stringify(notes));
    }

    function saveCurrentNote() {
      if (!currentNoteId) return;

      const noteIndex = notes.findIndex(n => n.id === currentNoteId);
      if (noteIndex === -1) return;

      // Update object
      notes[noteIndex].title = titleInput.value;
      notes[noteIndex].content = editorBody.innerHTML;
      notes[noteIndex].lastEdited = Date.now();

      // Update UI status
      saveStatus.innerText = "Saving...";
      headerTitle.innerText = titleInput.value || "Untitled";

      saveData();
      renderNotesList(); // Update sidebar titles
      updateTimeDisplay(Date.now());

      setTimeout(() => {
        saveStatus.innerText = "Saved";
        saveStatus.classList.add('saved');
      }, 500);
    }

    function deleteCurrentNote() {
      if (confirm('Are you sure you want to delete this note?')) {
        notes = notes.filter(n => n.id !== currentNoteId);
        saveData();
        if (notes.length > 0) {
          loadNote(notes[0].id);
        } else {
          createNewNote();
        }
        renderNotesList();
      }
    }

    // --- SIDEBAR RENDERER ---
    function renderNotesList() {
      notesListContainer.innerHTML = '';
      notes.forEach(note => {
        const el = document.createElement('div');
        el.className = `note-list-item ${note.id === currentNoteId ? 'active-note' : ''}`;
        el.onclick = () => {
          loadNote(note.id);
          if (window.innerWidth <= 900) toggleSidebar();
        };

        const title = note.title.trim() || 'Untitled Note';
        // simple relative time
        const date = new Date(note.lastEdited).toLocaleDateString(undefined, { month: 'short', day: 'numeric' });

        el.innerHTML = `
                <div class="note-item-title">${title}</div>
                <div class="note-item-date">${date}</div>
            `;
        notesListContainer.appendChild(el);
      });
    }

    // --- EVENT LISTENERS FOR AUTO SAVE ---
    titleInput.addEventListener('input', () => {
      // debounce slightly
      clearTimeout(window.saveTimeout);
      window.saveTimeout = setTimeout(saveCurrentNote, 500);
    });

    editorBody.addEventListener('input', (e) => {
      // Handle Slash Menu Trigger
      const sel = window.getSelection();
      if (sel.rangeCount > 0) {
        const txt = sel.anchorNode.textContent;
        // Simplified check: if text ends in /
        if (e.data === '/') {
          showSlashMenu();
        } else {
          slashMenu.style.display = 'none';
        }
      }

      clearTimeout(window.saveTimeout);
      window.saveTimeout = setTimeout(saveCurrentNote, 1000);
    });

    // --- COVER IMAGE HANDLING ---
    noteCover.addEventListener('click', () => fileInput.click());

    fileInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        // Check size (limit to ~2MB for LocalStorage safety)
        if (file.size > 2000000) {
          alert("Image is too large. Please use an image under 2MB.");
          return;
        }

        const reader = new FileReader();
        reader.onload = (event) => {
          const base64 = event.target.result;
          const noteIndex = notes.findIndex(n => n.id === currentNoteId);
          if (noteIndex > -1) {
            notes[noteIndex].coverImage = base64;
            loadNote(currentNoteId); // Refresh UI
            saveData();
          }
        }
        reader.readAsDataURL(file);
      }
    });

    // --- EDITOR COMMANDS (SLASH MENU) ---
    function showSlashMenu() {
      const selection = window.getSelection();
      if (selection.rangeCount === 0) return;

      const range = selection.getRangeAt(0);
      const rect = range.getBoundingClientRect();

      // Calculate position
      let top = rect.bottom + 10;
      let left = rect.left;

      // Mobile adjustments
      if (window.innerWidth < 500) {
        left = 20; // reset to left side
      }

      slashMenu.style.top = `${top}px`;
      slashMenu.style.left = `${left}px`;
      slashMenu.style.display = 'block';
    }

    // Execute standard execCommands
    function execCmd(command, value = null) {
      // Remove the slash
      document.execCommand('delete', false, null);
      document.execCommand(command, false, value);
      slashMenu.style.display = 'none';
      editorBody.focus();
    }

    // Custom Insert functions
    function insertCheckbox() {
      document.execCommand('delete', false, null); // remove slash
      const id = Date.now();
      const html = `
            <div class="todo-item">
                <div class="todo-checkbox" onclick="toggleTodo(this)"></div>
                <span class="todo-text" contenteditable="true">To-do item</span>
            </div>
            <div><br></div>
        `;
      document.execCommand('insertHTML', false, html);
      slashMenu.style.display = 'none';
    }

    function insertCodeBlock() {
      document.execCommand('delete', false, null);
      const html = `<pre><code>// Your code here</code></pre><p><br></p>`;
      document.execCommand('insertHTML', false, html);
      slashMenu.style.display = 'none';
    }

    // Global click to close menu
    document.addEventListener('click', (e) => {
      if (!slashMenu.contains(e.target)) {
        slashMenu.style.display = 'none';
      }
    });

    // Helper for Todo Toggling
    window.toggleTodo = function (el) {
      el.classList.toggle('checked');
      el.nextElementSibling.classList.toggle('checked');
      saveCurrentNote();
    }

    // --- MOBILE UTILS ---
    function toggleSidebar() {
      sidebar.classList.toggle('open');
      mobileOverlay.classList.toggle('active');
    }

    function updateTimeDisplay(timestamp) {
      const date = new Date(timestamp);
      const now = new Date();
      const diff = Math.floor((now - date) / 1000); // seconds

      let text = "";
      if (diff < 60) text = "Just now";
      else if (diff < 3600) text = `${Math.floor(diff / 60)}m ago`;
      else if (diff < 86400) text = `${Math.floor(diff / 3600)}h ago`;
      else text = date.toLocaleDateString();

      document.getElementById('lastEdited').innerText = text;
    }

  </script>
</body>

</html>
